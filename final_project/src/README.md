# ESP32 WiFi 紅外線電風扇控制系統

## 專案簡介

本專案實作一套基於 ESP32 的 WiFi 電風扇控制系統，使用 HTTP Server 架構，支援透過手機 App 或網頁 UI 操控電風扇（紅外線方式），同時結合溫濕度感測器並提供定時開關機功能。

---

## 系統架構

```
手機 App / 網頁 UI (HTML + JS)
⇅
WiFi 傳輸 (HTTP 協定)
⇅
ESP32 NodeMCU-32S
├── WiFi 模組（內建）
├── 紅外線發射器（IR LED）
├── IR 信號碼庫（電風扇遙控碼）
├── 控制邏輯（IR 發射驅動）
├── 溫濕度感測器
└── 定時控制邏輯（Server 端時間運算）
```

---

## 控制網頁功能說明

使用者可透過瀏覽器連線至 ESP32 內建的 HTTP Server，控制電風扇並監控環境資訊。介面功能包含：

- 開啟電風扇
- 關閉電風扇
- 風量變小
- 風量變大
- 設定定時開啟（選擇 0 ~ 300 分鐘，15 分鐘為間隔）
- 設定定時關閉（選擇 0 ~ 300 分鐘，15 分鐘為間隔）
- 顯示目前溫度與濕度

---

## 使用技術

### 硬體元件
- ESP32 NodeMCU-32S 開發板
- IR LED 發射模組（控制電風扇紅外線碼）
- DHT22 溫濕度感測器
- 電風扇遙控器（用來學習 IR Code）
- 附加元件：NPN電晶體、限流電阻等

### 軟體開發
- Arduino IDE（ESP32 開發）
- WiFi + HTTP Server（使用 WebServer.h）
- IRremoteESP8266 函式庫（紅外線發射）
- DHT 函式庫（讀取溫濕度）
- HTML / JavaScript（控制網頁 UI）

---

## 控制邏輯與路由 API

ESP32 會開啟一個 HTTP Server，提供下列路由供網頁與 App 呼叫：

| 路由 | 說明 |
|------|------|
| `/fan/on` | 開啟電風扇 |
| `/fan/off` | 關閉電風扇 |
| `/fan/up` | 風量變大 |
| `/fan/down` | 風量變小 |
| `/fan/timer_on?min=15` | 設定幾分鐘後開啟（0~300，15分鐘為單位） |
| `/fan/timer_off?min=30` | 設定幾分鐘後關閉（0~300，15分鐘為單位） |
| `/sensor` | 取得目前溫度與濕度（JSON 格式） |

> 若 `min=0` 則視為取消定時開/關。

---

## IR Code 學習方法

請使用一組紅外線接收器搭配以下程式來讀取電風扇遙控器按鍵對應的 IR raw code，再將這些碼儲存在 ESP32 程式中進行發射模擬。

建議工具：TSOP4838 接收器 + IRrecv 函式庫 + resultToSourceCode()

---

## 網頁 UI 功能

- 開
- 關
- 風量 +
- 風量 -
- 定時開 (點選後跳出懸浮區塊: 包含三個按鈕 「+」、「-」(點選後會以15分鐘為單位設定定時的時間，中間顯示所設定的時間) 以及「確認」(放在時間的下方，點選後關閉懸浮區塊並且將資料傳送給server，並且在網頁上顯示幾分鐘後開))
- 定時關 (操作邏輯與「定時開」相同)